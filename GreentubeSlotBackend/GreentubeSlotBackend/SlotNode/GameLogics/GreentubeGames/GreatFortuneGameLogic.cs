using GITProtocol;
using SlotGamesNode.GameLogics.BaseClasses;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SlotGamesNode.GameLogics
{
    internal class GreatFortuneGameLogic : BaseGreenSlotGame
    {
        #region
        protected override string ScatterSymbol {
            get
            {
                return "S";
            }
        }

        protected override int MinCountToFreespin
        {
            get
            {
                return 3;
            }
        }

        protected override string VersionCheckString
        {
            get
            {
                return "\b0ÿ2.5.16ÿCasino-Lobbymanager-Serverÿ2578ÿ1.10.54.0ÿRedlineSlotServerÿ11295ÿ1.0.0ÿGreat Fortune 95%ÿ1.119.0_2025-04-14_123855ÿ1.165.0";
            }
        }

        protected override string GameUniqueString
        {
            get
            {
                return "\u0006S0ÿA1ÿRÿM,10,10000,40,-1,0ÿI00ÿH,0,0,0,0,0,0ÿ:n,Great Fortune 95%ÿ:v,4ÿ:l,^^^^^ÿ:l,^^^^-ÿ:l,^^^--ÿ:l,^^^-_ÿ:l,^^-^^ÿ:l,^^--^ÿ:l,^^---ÿ:l,^^-__ÿ:l,^^-_Vÿ:l,^-^^^ÿ:l,^-^-^ÿ:l,^--^^ÿ:l,^---^ÿ:l,^----ÿ:l,^---_ÿ:l,^-_-^ÿ:l,^-__-ÿ:l,^-___ÿ:l,^-_VVÿ:l,-^^^^ÿ:l,-^^^-ÿ:l,-^^--ÿ:l,-^^-_ÿ:l,-^-^-ÿ:l,-^---ÿ:l,-^-_-ÿ:l,--^^^ÿ:l,--^^-ÿ:l,--^--ÿ:l,---^^ÿ:l,----^ÿ:l,-----ÿ:l,----_ÿ:l,---__ÿ:l,---_Vÿ:l,--_--ÿ:l,--__-ÿ:l,--___ÿ:l,--_VVÿ:l,-_-^-ÿ:r,0,K000A1TJK1KA1JT3KA4JT4KJSQKA000JK43AJ4KJSQK4JK1TK3AN1JTQ4KN1AJ2QKA1JNA3J4KA1JSK3AJ1QK1KA31QA2KT4AK000ATJK1KA1JT3KA4JT4AKJSQKA2000JK3AJ4KJSQK4JK1TK3A4N1JT4KN1AJ2QKA1JN3J4KA1JK3AJ1QK1KA1QA2JKT4AK000ATJK1KA1JT3KA4JT4KAJSQKA000JK3AJ4KJSQK4JK1TK3AN1JT4KN1AJ2QKA1JN3J4KA1JK3AJ1QK1KA1QA2KT4AK000ATJK1KA1JT43KA4JT4KJSQKA000JTK3AJ4KJSQK4JK1TK3AN1JT4KNS1AJ2QKA1J4N3J4KA1JK3AJ1QK1KA1QA2KT4Aÿ:r,0,TJ1TQ2NT4KT000J0A2T4N2TQ2TQ2AT0WNT2QA2TKJ2T3Q2AST2J4T2Q3N2JWK2T3Q2NQ3T2KWT2Q4AT2JTSQA2Q13Q4NKTJ1TQ2NT4KT000J0A2T4N2TQ32TQ2ATWNT42QA2TJN2T3Q2AST21J4T2Q3N2JWK2T3Q2N3T2KWT2Q4AT2JTSQA2Q13Q4NKTJ1TQ2NT4KT000J0A2T4N2TQ20TQ2ATWNT20QA2TJ2T3NQ2AST2J41T2Q3NA2JWK2TA3Q2N3T2KW3T2Q4AT2JTSQ3A2Q13Q4NKTJ1TQ2NT4AKT000J0A2T4N2TQ2TQ2ATWNT2QA12TJ2T3Q2AST2J4T12Q3N2AJWK2T3Q2N3T2KWT2Q4AT2JTSQAW2Q13Q4NKÿ:r,0,T003QN4N11NA2J4N3Q2WT000TQ2J4N3Q2TN4JN3QWT2NQ4J3NWQT00022N4Q3NSJNQ3N2W3N1K2N4QWAJ1N2AWTNJ3TNSQWJ2NT00Q3N4N11N2NJ4N3Q2T000TQ2J4N3Q2TN4JN3NQWT2NQ4J3N00WQT22N4Q3NSNQ3N2W3N1K2N4QWAJ1N2AWTNJ3TNSQJ2NT00QN4N11N2JT4N3Q2T000TQ2J4N3QN2TN4JN3QWT2NQ4J3NWQT22N4Q3NSNQJ3N2W3N1K2N4QWAJ1N2AWTNJ3TNSQJ2NT00QN4N11WN2J4N3AQ2T000TQ2J4N3Q2TN4JN3QWT2NQ4J3NWQT22N4JQ3NSNQ3N2W3N1K2N4QTWAJ1N2AWTNJ3TNSQJ2Nÿ:r,0,A4400KQ14A4JN000A1K44Q1WN34AS2K00Q31N3A44KWQ2J1K3WK4TJ1K3T000Q211A44KWN4A4K11N3TWA4K1A3JSK4A00K3Q14A4J000A1K44Q1000WN34AS2K00Q31N3A44KWQ2J1K3WK4TJ1K3T000Q11A44KWN4A400K11N3TWA4K1A3JSK4A00KQ14A4J000A1K44Q1WN34AS2K00Q31N3A44KWQ2J1K3WK4TJ1K443T000Q11A44KWN4A4K11N3TWA4K1A3JSK4A00KQ14A4J000A1K44Q1WN34AS2K00Q31N3A44KWQ2J1K3WKA4TJ1K3T000Q11A44KWN4A4K11N3TWA400K1A3JTSK4ÿ:r,0,K312A000Q1J0002K3A1T2K3JSK1A33T2KQSK3A1N22Q4K3ASKN33T11A000JQ1T000A3SJ12N3A1Q2N3A1K3A1K000A1K3A1NK312A000Q1J2NK3A1T2K3JSK1A33T2KQSK3A1N22JQ4K3ASNJ33T11A000J1QT000A3J12N3A1Q2N3A1K3A1K000A122K3A1NK312A000Q1J2K3A1T2K3JSK1A33T2KQSK3A1N22Q4K3ASN33TK11A000J1TK000A3J12N3A1Q2N3A1K3A1K000A1K3A1NK312A000Q1J2K3A1T2K3JSK1A33T2KQSK3A1N22Q4K3ASN33T11A000J1T000QA3J12N3A1Q2N3A1K3A1K000A1K3A1Nÿ:r,1,K000A1TJK1KA1JT3KA4JT4KJSQKA000JK43AJ4KJSQK4JK1TK3AN1JTQ4KN1AJ2QKA1JNA3J4KA1JSK3AJ1QK1KA31QA2KT4AK000ATJK1KA1JT3KA4JT4AKJSQKA2000JK3AJ4KJSQK4JK1TK3A4N1JT4KN1AJ2QKA1JN3J4KA1JK3AJ1QK1KA1QA2JKT4AK000ATJK1KA1JT3KA4JT4KAJSQKA000JK3AJ4KJSQK4JK1TK3AN1JT4KN1AJ2QKA1JN3J4KA1JK3AJ1QK1KA1QA2KT4AK000ATJK1KA1JT43KA4JT4KJSQKA000JTK3AJ4KJSQK4JK1TK3AN1JT4KNS1AJ2QKA1J4N3J4KA1JK3AJ1QK1KA1QA2KT4Aÿ:r,1,TJ1TQ2NT4KT000J0A2T4N2TQ2TQ2AT0WNT2QA2TKJ2T3Q2AST2J4T2Q3N2JWK2T3Q2NQ3T2KWT2Q4AT2JTSQA2Q13Q4NKTJ1TQ2NT4KT000J0A2T4N2TQ32TQ2ATWNT42QA2TJN2T3Q2AST21J4T2Q3N2JWK2T3Q2N3T2KWT2Q4AT2JTSQA2Q13Q4NKTJ1TQ2NT4KT000J0A2T4N2TQ20TQ2ATWNT20QA2TJ2T3NQ2AST2J41T2Q3NA2JWK2TA3Q2N3T2KW3T2Q4AT2JTSQ3A2Q13Q4NKTJ1TQ2NT4AKT000J0A2T4N2TQ2TQ2ATWNT2QA12TJ2T3Q2AST2J4T12Q3N2AJWK2T3Q2N3T2KWT2Q4AT2JTSQAW2Q13Q4NKÿ:r,1,T003QN4N11NA2J4N3Q2WT000TQ2J4N3Q2TN4JN3QWT2NQ4J3NWQT00022N4Q3NSJNQ3N2W3N1K2N4QWAJ1N2AWTNJ3TNSQWJ2NT00Q3N4N11N2NJ4N3Q2T000TQ2J4N3Q2TN4JN3NQWT2NQ4J3N00WQT22N4Q3NSNQ3N2W3N1K2N4QWAJ1N2AWTNJ3TNSQJ2NT00QN4N11N2JT4N3Q2T000TQ2J4N3QN2TN4JN3QWT2NQ4J3NWQT22N4Q3NSNQJ3N2W3N1K2N4QWAJ1N2AWTNJ3TNSQJ2NT00QN4N11WN2J4N3AQ2T000TQ2J4N3Q2TN4JN3QWT2NQ4J3NWQT22N4JQ3NSNQ3N2W3N1K2N4QTWAJ1N2AWTNJ3TNSQJ2Nÿ:r,1,A4400KQ14A4JN000A1K44Q1WN34AS2K00Q31N3A44KWQ2J1K3WK4TJ1K3T000Q211A44KWN4A4K11N3TWA4K1A3JSK4A00K3Q14A4J000A1K44Q1000WN34AS2K00Q31N3A44KWQ2J1K3WK4TJ1K3T000Q11A44KWN4A400K11N3TWA4K1A3JSK4A00KQ14A4J000A1K44Q1WN34AS2K00Q31N3A44KWQ2J1K3WK4TJ1K443T000Q11A44KWN4A4K11N3TWA4K1A3JSK4A00KQ14A4J000A1K44Q1WN34AS2K00Q31N3A44KWQ2J1K3WKA4TJ1K3T000Q11A44KWN4A4K11N3TWA400K1A3JTSK4ÿ:r,1,K312A000Q1J0002K3A1T2K3JSK1A33T2KQSK3A1N22Q4K3ASKN33T11A000JQ1T000A3SJ12N3A1Q2N3A1K3A1K000A1K3A1NK312A000Q1J2NK3A1T2K3JSK1A33T2KQSK3A1N22JQ4K3ASNJ33T11A000J1QT000A3J12N3A1Q2N3A1K3A1K000A122K3A1NK312A000Q1J2K3A1T2K3JSK1A33T2KQSK3A1N22Q4K3ASN33TK11A000J1TK000A3J12N3A1Q2N3A1K3A1K000A1K3A1NK312A000Q1J2K3A1T2K3JSK1A33T2KQSK3A1N22Q4K3ASN33T11A000J1T000QA3J12N3A1Q2N3A1K3A1K000A1K3A1Nÿ:j,W,1,0,01234AKQJTNÿ:j,E,1,0,01234AKQJTNÿ:j,X,1,0,01234AKQJTNÿ:u,APPPP.PP.PP.PPPPÿ:w,0,2,10,0ÿ:w,0,3,40,0ÿ:w,0,4,100,0ÿ:w,0,5,150,0ÿ:w,1,3,30,0ÿ:w,1,4,50,0ÿ:w,1,5,150,0ÿ:w,2,3,30,0ÿ:w,2,4,50,0ÿ:w,2,5,150,0ÿ:w,3,3,15,0ÿ:w,3,4,30,0ÿ:w,3,5,100,0ÿ:w,4,3,15,0ÿ:w,4,4,30,0ÿ:w,4,5,100,0ÿ:w,A,3,10,0ÿ:w,A,4,20,0ÿ:w,A,5,50,0ÿ:w,K,3,10,0ÿ:w,K,4,20,0ÿ:w,K,5,50,0ÿ:w,Q,3,5,0ÿ:w,Q,4,20,0ÿ:w,Q,5,50,0ÿ:w,J,3,5,0ÿ:w,J,4,20,0ÿ:w,J,5,50,0ÿ:w,T,3,5,0ÿ:w,T,4,10,0ÿ:w,T,5,40,0ÿ:w,N,2,2,0ÿ:w,N,3,5,0ÿ:w,N,4,10,0ÿ:w,N,5,40,0ÿ:w,S,5,-10,0ÿ:w,S,4,-5,0ÿ:w,S,3,-2,0ÿ:wa,0,2,10,0,0,0,0:1,-1,0ÿ:wa,0,3,40,0,0,0,0:1,-1,0ÿ:wa,0,4,100,0,0,0,0:1,-1,0ÿ:wa,0,5,150,0,0,0,0:1,-1,0ÿ:wa,1,3,30,0,0,0,0:1,-1,0ÿ:wa,1,4,50,0,0,0,0:1,-1,0ÿ:wa,1,5,150,0,0,0,0:1,-1,0ÿ:wa,2,3,30,0,0,0,0:1,-1,0ÿ:wa,2,4,50,0,0,0,0:1,-1,0ÿ:wa,2,5,150,0,0,0,0:1,-1,0ÿ:wa,3,3,15,0,0,0,0:1,-1,0ÿ:wa,3,4,30,0,0,0,0:1,-1,0ÿ:wa,3,5,100,0,0,0,0:1,-1,0ÿ:wa,4,3,15,0,0,0,0:1,-1,0ÿ:wa,4,4,30,0,0,0,0:1,-1,0ÿ:wa,4,5,100,0,0,0,0:1,-1,0ÿ:wa,A,3,10,0,0,0,0:1,-1,0ÿ:wa,A,4,20,0,0,0,0:1,-1,0ÿ:wa,A,5,50,0,0,0,0:1,-1,0ÿ:wa,K,3,10,0,0,0,0:1,-1,0ÿ:wa,K,4,20,0,0,0,0:1,-1,0ÿ:wa,K,5,50,0,0,0,0:1,-1,0ÿ:wa,Q,3,5,0,0,0,0:1,-1,0ÿ:wa,Q,4,20,0,0,0,0:1,-1,0ÿ:wa,Q,5,50,0,0,0,0:1,-1,0ÿ:wa,J,3,5,0,0,0,0:1,-1,0ÿ:wa,J,4,20,0,0,0,0:1,-1,0ÿ:wa,J,5,50,0,0,0,0:1,-1,0ÿ:wa,T,3,5,0,0,0,0:1,-1,0ÿ:wa,T,4,10,0,0,0,0:1,-1,0ÿ:wa,T,5,40,0,0,0,0:1,-1,0ÿ:wa,N,2,2,0,0,0,0:1,-1,0ÿ:wa,N,3,5,0,0,0,0:1,-1,0ÿ:wa,N,4,10,0,0,0,0:1,-1,0ÿ:wa,N,5,40,0,0,0,0:1,-1,0ÿ:wa,S,5,-10,0,0,0,0:1,-1,0ÿ:wa,S,4,-5,0,0,0,0:1,-1,0ÿ:wa,S,3,-2,0,0,0,0:1,-1,0ÿ:s,0ÿ:i,40ÿ:m,40ÿ:a,0,0ÿ:g,999,1000,-1,false,0,falseÿ:es,0,0ÿ:mbnr,0.0ÿ:fs,0,0,0,0,0,0ÿbs,0,1,0ÿ:k,nullÿe,40,0,0,-1ÿb,0,0,0ÿs,1ÿr,0,5,48,92,5,25,21ÿx,1,######ÿrw,0";
            }
        }
        #endregion

        public GreatFortuneGameLogic()
        {
            _gameID = GAMEID.GreatFortune;
            GameName = "GreatFortune";
        }

        protected override string buildLineBetString(string strGlobalUserID, double balance)
        {
            return string.Format("\u0006S{0}ÿA0ÿC,100.0,,1,ÿT,0,0,0ÿRÿM,40,2000,40,-1,0ÿI00ÿH,0,0,0,0,0,0ÿY,7200,10ÿ:i,40ÿ:m,40ÿ:b,12,1,2,3,4,5,8,10,15,20,30,40,50ÿ:a,0,0ÿ:g,999,1000,-1,false,0,falseÿ:es,0,0ÿ:mbnr,40.0ÿbs,0,1,0ÿ:k,nullÿe,{1},{2},{3},-1ÿb,1000,1000,0ÿs,1ÿr,0,5,48,92,5,25,21ÿx,1,######ÿrw,0", balance, !_dicUserBetInfos.ContainsKey(strGlobalUserID) ? this._defaultLine : _dicUserBetInfos[strGlobalUserID].PlayLine, !_dicUserBetInfos.ContainsKey(strGlobalUserID) ? this._defaultBetPerLine : (_dicUserBetInfos[strGlobalUserID].PlayBet / _dicUserBetInfos[strGlobalUserID].PlayLine), !_dicUserBetInfos.ContainsKey(strGlobalUserID) ? Array.IndexOf(_supportLines, this._defaultLine) : Array.IndexOf(_supportLines, _dicUserBetInfos[strGlobalUserID].PlayLine));
        }

        protected override void onDoInit(string strGlobalUserID, GITMessage message, double balance, Currencies currency)
        {
            try
            {
                GITMessage resMessage = new GITMessage((ushort)SCMSG_CODE.SC_GREENTUBE_DOINIT);
                resMessage.Append("%t0ÿq0");
                resMessage.Append(VersionCheckString);
                foreach (string currencyName in SupportCurrencyList)
                {
                    resMessage.Append(currencyName);
                }
                resMessage.Append(buildInitString(strGlobalUserID, balance, currency));
                resMessage.Append("\vGAMEVARIATIONÿ665ÿTICKETSÿ1");
                resMessage.Append(GameUniqueString);

                resMessage.Append("%t0ÿq0");
                resMessage.Append($"\aNATIVEJACKPOTCURRENCYFACTORÿ100.0ÿMAXBUYINTOTALÿ0ÿNEEDSSESSIONTIMEOUTÿ0ÿRELIABILITYÿ0ÿNICKNAMEÿ155258EURÿIDÿ155258ÿISDEEPWALLETÿ0ÿCURRENCYFACTORÿ100.0ÿMINBUYINÿ1ÿSESSIONTIMEOUTMINUTESÿ60ÿJACKPOT_PROGRESSIVE_CAPÿ0.0ÿNATIVEJACKPOTCURRENCYÿ{getCurrencyCode(currency)}ÿEXTUSERIDÿDummyDB_ExternalUserId_155258EURÿFREESPINSISCAPREACHEDÿ0ÿCURRENCYÿ{getCurrencySymbol(currency)}ÿTICKETSÿ0ÿJACKPOT_TOTAL_CAPÿ0.0ÿJACKPOTFEEPERCENTAGEÿ0.0ÿISSHOWJACKPOTCONTRIBUTIONÿ0");
                resMessage.Append(buildLineBetString(strGlobalUserID, balance));

                ToUserMessage toUserMessage = new ToUserMessage((int)_gameID, resMessage);

                Sender.Tell(toUserMessage, Self);
            }
            catch (Exception ex)
            {
                _logger.Error("Exception has been occurred in BaseGreentubeSlotGame::onDoInit GameID: {0}, {1}", _gameID, ex);
            }
        }
        protected override void onBalanceConfirm(string strGlobalUserID, GITMessage message, double balance, Currencies currency)
        {
            try
            {
                GITMessage resMessage = new GITMessage((ushort)SCMSG_CODE.SC_GREENTUBE_BALANCECONFIRM);
                resMessage.Append("%t0ÿq0");
                resMessage.Append($"\aNATIVEJACKPOTCURRENCYFACTORÿ100.0ÿMAXBUYINTOTALÿ0ÿNEEDSSESSIONTIMEOUTÿ0ÿRELIABILITYÿ0ÿNICKNAMEÿ155258EURÿIDÿ155258ÿISDEEPWALLETÿ0ÿCURRENCYFACTORÿ100.0ÿMINBUYINÿ1ÿSESSIONTIMEOUTMINUTESÿ60ÿJACKPOT_PROGRESSIVE_CAPÿ0.0ÿNATIVEJACKPOTCURRENCYÿ{getCurrencyCode(currency)}ÿEXTUSERIDÿDummyDB_ExternalUserId_155258EURÿFREESPINSISCAPREACHEDÿ0ÿCURRENCYÿ{getCurrencySymbol(currency)}ÿTICKETSÿ0ÿJACKPOT_TOTAL_CAPÿ0.0ÿJACKPOTFEEPERCENTAGEÿ0.0ÿISSHOWJACKPOTCONTRIBUTIONÿ0");
                resMessage.Append(buildLineBetString(strGlobalUserID, balance));
                ToUserMessage toUserMessage = new ToUserMessage((int)_gameID, resMessage);

                Sender.Tell(toUserMessage, Self);
            }
            catch (Exception ex)
            {
                _logger.Error("Exception has been occurred in BaseGreentubeSlotGame::onDoInit GameID: {0}, {1}", _gameID, ex);
            }
        }
    }
}
